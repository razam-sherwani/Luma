{% extends 'base.html' %}

{% block title %}How This Recommendation Was Created - ProviderPulse{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-100">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="flex flex-col lg:flex-row lg:justify-between lg:items-center mb-8">
            <div class="mb-4 lg:mb-0">
                <h1 class="text-3xl font-bold text-gray-900 mb-2">How This Recommendation Was Created</h1>
                <p class="text-gray-600">{{ recommendation.recommendation_title }}</p>
                <p class="text-sm text-gray-500">For {{ recommendation.hcp.name }} | {{ recommendation.hcp.specialty }}</p>
            </div>
            <div class="flex space-x-3">
                <a href="{% url 'view_recommendation' recommendation.id %}" 
                   class="inline-flex items-center px-4 py-2 bg-white border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors duration-200 shadow-sm">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                    </svg>
                    Back to Recommendation
                </a>
                {% if is_hcr %}
                <a href="{% url 'dashboard' %}" 
                   class="inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200 shadow-sm">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5a2 2 0 012-2h4a2 2 0 012 2v2H8V5z"></path>
                    </svg>
                    Dashboard
                </a>
                {% endif %}
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Clustering Process -->
            <div class="space-y-6">
                <div class="bg-white rounded-lg shadow-md border border-gray-300">
                    <div class="bg-gradient-to-r from-purple-500 to-blue-500 px-6 py-4 text-white">
                        <h2 class="text-xl font-semibold flex items-center">
                            <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                            </svg>
                            {{ clustering_explanation.process }}
                        </h2>
                    </div>
                    <div class="p-6">
                        <p class="text-gray-700 mb-6 leading-relaxed">{{ clustering_explanation.description }}</p>
                        
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Process Steps:</h3>
                        <div class="space-y-3">
                            {% for step in clustering_explanation.steps %}
                            <div class="flex items-start">
                                <div class="flex-shrink-0 w-6 h-6 bg-purple-100 rounded-full flex items-center justify-center mr-3 mt-0.5">
                                    <span class="text-xs font-semibold text-purple-600">{{ forloop.counter }}</span>
                                </div>
                                <p class="text-gray-700">{{ step }}</p>
                            </div>
                            {% endfor %}
                        </div>
                        
                        <div class="mt-6 p-4 bg-purple-50 rounded-lg">
                            <h4 class="font-semibold text-gray-900 mb-3">Your Cluster Analysis Results:</h4>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-purple-600">{{ clustering_explanation.cluster_details.patient_count }}</div>
                                    <div class="text-sm text-gray-600">Patients Analyzed</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-purple-600">{{ clustering_explanation.cluster_details.success_rate }}%</div>
                                    <div class="text-sm text-gray-600">Success Rate</div>
                                </div>
                            </div>
                            <div class="mt-3 text-center">
                                <div class="text-lg font-semibold text-gray-800">{{ clustering_explanation.cluster_details.cluster_name }}</div>
                                <div class="text-sm text-gray-600">Cluster ID: {{ clustering_explanation.cluster_details.cluster_id }}</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Research Analysis -->
            <div class="space-y-6">
                <div class="bg-white rounded-lg shadow-md border border-gray-300">
                    <div class="bg-gradient-to-r from-green-500 to-teal-500 px-6 py-4 text-white">
                        <h2 class="text-xl font-semibold flex items-center">
                            <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                            </svg>
                            {{ webscraping_explanation.process }}
                        </h2>
                    </div>
                    <div class="p-6">
                        <p class="text-gray-700 mb-6 leading-relaxed">{{ webscraping_explanation.description }}</p>
                        
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Research Process:</h3>
                        <div class="space-y-3">
                            {% for step in webscraping_explanation.steps %}
                            <div class="flex items-start">
                                <div class="flex-shrink-0 w-6 h-6 bg-green-100 rounded-full flex items-center justify-center mr-3 mt-0.5">
                                    <span class="text-xs font-semibold text-green-600">{{ forloop.counter }}</span>
                                </div>
                                <p class="text-gray-700">{{ step }}</p>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>

                <!-- Research Articles -->
                {% if webscraping_explanation.research_details %}
                <div class="bg-white rounded-lg shadow-md border border-gray-300">
                    <div class="bg-gray-100 px-6 py-4 border-b border-gray-300">
                        <h3 class="text-lg font-semibold text-gray-900">ðŸ“š Supporting Research Articles</h3>
                    </div>
                    <div class="p-6">
                        <div class="space-y-6">
                            {% for article in webscraping_explanation.research_details %}
                            <div class="border-l-4 border-green-500 pl-4 py-4 bg-green-50 rounded-r-lg">
                                <div class="flex justify-between items-start mb-2">
                                    <h4 class="font-semibold text-gray-900 text-lg">{{ article.title }}</h4>
                                    <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                        {% widthratio article.relevance_score 1 100 %}% Relevant
                                    </span>
                                </div>
                                
                                <div class="text-sm text-gray-600 mb-3">
                                    <p><strong>Authors:</strong> {{ article.authors }}</p>
                                    <p><strong>Journal:</strong> {{ article.journal }}</p>
                                    {% if article.publication_date %}
                                    <p><strong>Published:</strong> {{ article.publication_date|date:"F Y" }}</p>
                                    {% endif %}
                                </div>
                                
                                <p class="text-gray-700 mb-3">{{ article.abstract }}</p>
                                
                                {% if article.keywords %}
                                <div class="mb-3">
                                    <span class="text-sm font-medium text-gray-700">Keywords:</span>
                                    <div class="flex flex-wrap gap-1 mt-1">
                                        {% for keyword in article.keywords %}
                                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                            {{ keyword }}
                                        </span>
                                        {% endfor %}
                                    </div>
                                </div>
                                {% endif %}
                                
                                <div class="flex justify-between items-center">
                                    <div class="text-sm text-gray-600">
                                        {% if article.conditions_mentioned %}
                                        <p><strong>Conditions:</strong> {{ article.conditions_mentioned|join:", " }}</p>
                                        {% endif %}
                                        {% if article.treatments_mentioned %}
                                        <p><strong>Treatments:</strong> {{ article.treatments_mentioned|join:", " }}</p>
                                        {% endif %}
                                    </div>
                                    <a href="/dashboard/research/{{ forloop.counter }}/" target="_blank" 
                                       class="inline-flex items-center px-3 py-1 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 transition-colors">
                                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                                        </svg>
                                        View Study
                                    </a>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Summary -->
        <div class="mt-8 bg-white rounded-lg shadow-md border border-gray-300">
            <div class="bg-gradient-to-r from-gray-500 to-gray-600 px-6 py-4 text-white">
                <h2 class="text-xl font-semibold flex items-center">
                    <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    How It All Comes Together
                </h2>
            </div>
            <div class="p-6">
                <p class="text-gray-700 leading-relaxed mb-4">
                    This recommendation combines insights from both AI-powered patient clustering and evidence-based research analysis. 
                    The clustering analysis identified patterns in your patient data, while the research analysis provided clinical evidence 
                    to support the recommended treatments. This dual approach ensures that recommendations are both data-driven and 
                    clinically validated.
                </p>
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h4 class="font-semibold text-gray-900 mb-2">Key Benefits of This Approach:</h4>
                    <ul class="space-y-1 text-gray-700">
                        <li>â€¢ <strong>Personalized:</strong> Based on your actual patient data and outcomes</li>
                        <li>â€¢ <strong>Evidence-based:</strong> Supported by peer-reviewed medical research</li>
                        <li>â€¢ <strong>Transparent:</strong> You can see exactly how the recommendation was generated</li>
                        <li>â€¢ <strong>Actionable:</strong> Specific treatments with clear success metrics</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
